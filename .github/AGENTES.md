# AI Agent 作業ガイドライン  

この文書は、AI Agent がタスクを実行する際に、手順や判断基準がぶれないようにするための標準プロトコルです。  
Agent は以下の指示を常に優先し、必ず順守してください。

---

## 0. Branch Handling Rules (Agent must follow)

1. Before modifying any file, the Agent must:
   - Check the current Git branch by executing:  
     `git branch --show-current`
   - If the branch name is `main` or `master`, the Agent must **not** start editing.

2. If on `main` or `master`, the Agent must:
   - Ask the user:  
     「作業用ブランチを作成してよいですか？  
       ブランチ名の提案: `feature/<task-summary>`」

3. If the user approves:
   - Execute the following command in terminal:  
     `git switch -c feature/<task-summary>`
   - Confirm that the switch was successful.

4. Only after the branch is successfully created and checked out:
   - Proceed with file modifications.

5. If branch creation fails:
   - Show the full terminal output.
   - Ask the user how to proceed.

## 1. コミット前の作業プロセス

1. **コードスタイルのチェック**  
   - Microsoft C# コード規則に準拠しているか確認すること。  
   - 違反がある場合は自動修正案を提示し、修正して続行するか私に確認すること。

2. **ビルドとテストの実行**  
   - Build と Test を必ず実施すること。  
   - 失敗があれば原因を説明し、修正案を提示すること。

3. **不要ファイルの排除**  
   - 一時ファイル・デバッグ用コード・不要なログ出力が残っていないか確認し、見つけた場合は削除すること。

---

## 2. コミット作成ルール

1. **Conventional Commits に準拠**  
   - コミットメッセージは必ず **英語**で書くこと。  
   - 先頭行（subject）は 50 文字以内に収めること。

2. **論理単位でのコミット分割**  
   - 変更が複数ある場合は、意味単位ごとにコミットを分けること。

3. **必要に応じ詳細を記述**  
   - 変更理由・背景・副作用がある場合は body を追記すること。

---


## 3. 処理速度・メモリ使用量の最適化が目的の場合の特殊ルール

0. **ベンチマーク記録方法の検討**
   - ベンチーマーク用のコードならびに結果(*.md)を保存するフォルダは /benchmarks　内とすること。
   - ベンチマーク用のコードは、既存のコードで大丈夫か検討し、必要に応じて目的にあったコードを生成すること。
   - ベンチーマーク結果(*.md)を保存するファイルは、既存のドキュメントに追記して整合性がとれるか検討し、必要に応じて目的にあったファイルを生成すること。

1. **ベンチマークの取得**  
   - ブランチを切った直後に、baseline を取得し記録、コミットし、ver.タグをつけること。  
   - 最適化後にも同条件でベンチマークを取り、改善幅を比較すること。

2. **ベンチマークの記録**  
   - 結果は Markdown (`benchmarks/*.md`) として保存すること。

3. **コミット内容の明確化**  
   - コミットメッセージに「目的」「改善内容」「ベンチマーク概要」を含めること。

4. **タグの付与**  
   - 最適化完了時のコミットにはタグを付け、後から追跡できるようにすること。

---

## 4. ドキュメント更新ポリシー

### 4.1 更新タイミングの原則
- **ドキュメントは main ブランチの HEAD と常に整合するように管理すること。**
- 開発ブランチでは README.md や公開ドキュメントを変更しないこと。
- 開発ブランチでは、必要な説明や補足は `docs/drafts/` に一時保存すること。
- **main へマージする直前に、変更内容をまとめてドキュメントに反映すること。**
- main にマージされた時点の内容が「公開仕様」となる。

### 4.2 ドキュメント作成・更新ルール
1. コード変更に関連する箇所を必ず更新すること。  
2. 使用例・変更点・注意事項を明確に記述すること。  
3. プロジェクトのスタイルガイドに従うこと。  
4. ドキュメントを最新状態に保ち、他の開発者が理解しやすい形に維持すること。

---

## 5. パッケージ公開前チェックリスト

1. **公式ドキュメントの更新**  
   - main ブランチ上で README.md、docs/USAGE.md などを更新する。

2. **CHANGELOG の更新**  
   - 変更内容を CHANGELOG.md に反映すること。  
   - バージョン番号は Semantic Versioning に従って更新すること。

3. **テストの完全成功**  
   - テストが一つでも失敗している場合、公開処理を中止し修正すること。

4. **NuGet メタデータの検証**  
   - タイトル、説明、著者、ライセンス、依存関係が正しいか確認する。

5. **ローカル動作確認**  
   - `dotnet pack` → `dotnet add package` を用いて実際の利用動作を確認すること。

6. **セキュリティチェック**  
   - 公開前に脆弱性スキャンを実行し、問題がないことを確認すること。

7. **公開後の確認**  
   - パッケージが NuGet Gallery で正常にインデックスされているか確認する。

8. **リリースコミットとタグ**  
   - 公開時のコミットにはタグを付け、リリースノートを添付すること。

---

## 6. Agent への補足指示

- 不明点がある場合は **必ず質問してから作業を続行すること**。  
- 曖昧な仕様や判断が必要な場合は、合理的な案を示し、承認を得てから実行すること。  
- 変更が広範囲に及ぶ場合は、作業計画（タスク分割案）を提示してから着手すること。

---

以上のプロトコルに従い、作業の品質・再現性を維持すること。
